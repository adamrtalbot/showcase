# `seqeralabs/showcase` Workspace on Seqera Platform

## Infrastructure as code

Infrastructure as Code (IaC) provides the ability to provision and manage infrastructure through configuration files. Having IaC enables automation in set up, consistency and standardization in infrastructure, and documentation of how resources are configured.

This guide describes how to create resources on Seqera Platform through IaC using two methods: (1) Seqera Platform CLI, and (2) seqerakit.

### 1. Using Seqera Platform CLI

Most [Seqera Platform](https://seqera.io/platform/) entities such as Pipelines, Compute Environments and Datasets can be exported in JSON format via the [Seqera Platform CLI](https://github.com/seqeralabs/tower-cli#nextflow-tower-cli). This is very useful for creating IaC to store the exact configuration options used to create these entities, and to share and track changes over time.

This repository contains JSON representation of the Seqera Platform entitites generated by the Platform CLI that were used to create the `seqeralabs/showcase` Workspace:

- [Compute Environments](compute-envs) for AWS, Azure, Google Cloud, and SLURM
- [Pipelines](pipelines) from a select set of [nf-core pipelines](https://nf-co.re/pipelines)
- [Datasets](datasets) for running the pipelines with minimal test data

#### Running the Bash scripts

The bash scripts required to programatically import and export these entities from Seqera Platform via the CLI have also been provided in the [`scripts`](scripts) directory.

To create the Compute Environments:

```bash
bash scripts/bash/tw_computeenvs_import.sh
```

To add the Datasets:

```bash
bash scripts/bash/tw_datasets_add.sh
```

To add the Pipelines:

```bash
bash scripts/bash/tw_pipelines_import.sh
```

See Seqera Platform CLI [usage docs](https://github.com/seqeralabs/tower-cli/blob/master/USAGE.md#usage-examples) for more examples of interacting with the Platform.

#### Software Prerequisites

1. [Seqera Platform CLI](https://github.com/seqeralabs/tower-cli#1-installation) installed
2. [`jq`](https://stedolan.github.io/jq/) installed

#### Assumptions

- [Seqera Platform CLI](https://github.com/seqeralabs/tower-cli#1-installation) installed and `tw info` has been configured
- `TOWER_API_ENDPOINT` and `TOWER_ACCESS_TOKEN` have been injected into the executing environment (see the [Seqera Platform CLI documentation](https://github.com/seqeralabs/tower-cli/tree/master?tab=readme-ov-file#2-configuration) on configuring these)
- Credentials for AWS, Azure, and Google have already been set-up in Seqera Platform

### 2. Using `seqerakit`

The [Seqera Platform](https://https://seqera.io/platform/) entities represented above in JSON can also be represented as YAML configuration files. These configuration YAMLs can be used by `seqerakit`, a Python package wrapping the Seqera Platform CLI, to define and automate how entities should be created.

This repository also contains YAML configuration files defining creation of Seqera Platform entities on the `seqeralabs/showcase` Workspace with `seqerakit`:

- [Compute Environments](seqerakit/compute-envs/)
- [Pipelines](seqerakit/pipelines/)
- [Datasets](seqerakit/datasets/)

#### Prerequisites

To use `seqerakit`, you will need to have:

- The [Seqera Platform CLI](https://github.com/seqeralabs/tower-cli#1-installation) installed and `tw info` has been configured as described above
- `TOWER_API_ENDPOINT` and `TOWER_ACCESS_TOKEN` environment variables set
  Credentials for AWS, Azure, and Google have already been set-up in Seqera Platform
- The package installed via:

```bash
conda install seqerakit
```

Or:

```bash
pip install seqerakit
```

Please refer to the package's [installation guide](https://github.com/seqeralabs/seqera-kit?tab=readme-ov-file#installation) for more details on the required dependencies.

#### Running `seqerakit`

Similar to executing the scripts above to import and create Pipelines, Compute Environments, and Datasets that are defined in JSON onto Seqera Platform, the [YAML files](#using-seqerakit) provided in this repository can also be used to create `seqeralabs/showcase` entities on the Platform. For example:

To create the Compute Environments:

```bash
seqerakit seqerakit/compute-envs/*
```

To add the Datasets:

```bash
seqerakit seqerakit/datasets/*
```

To add the Pipelines:

```bash
seqerakit seqerakit/pipelines/*
```

See the [seqerakit documentation](https://github.com/seqeralabs/seqera-kit#-seqerakit) for more usage examples and options for running `seqerakit`.
